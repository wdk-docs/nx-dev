# 创建库

像编程中的许多决策一样，决定是否创建一个新的 Nx 库完全是一种权衡。
每个组织将决定他们自己的惯例，但这里有一些权衡，在你进行对话时要记住。

## 我应该建一个新库吗?

将代码分解成更多的库有三个主要好处。

### 1. 更快的命令

你的库粒度越大，`nx affected`和 Nx 的计算缓存的效率就越高。
例如，如果`libraryA`包含 10 个测试，但其中只有 5 个受到特定代码更改的影响，则所有 10 个测试都将由`nx affected --target=test`运行。
如果您可以预测哪 5 个测试通常一起运行，那么您可以将所有相关的代码分割到一个单独的库中，从而允许这两组 5 个测试独立执行。

### 2. 可视化体系结构

`nx graph` 命令生成一个图表，显示应用程序和库如何相互依赖。
如果您的大部分代码存在于几个巨大的库中，那么这种可视化不会提供太多的价值。
在命令中添加`--watch`标志会在你更改时更新浏览器中的可视化。

### 3. 强制约束

您可以对不同类型的库如何相互依赖施加约束[使用标签](/structure/monorepo-tags).
按照预先确定的约定，将何种代码放入不同类型的库中，可以让标签系统执行良好的体系结构模式。

此外，每个库都定义了自己的 API，这允许封装代码库的其他部分无法访问的逻辑。
您甚至可以使用[CODEOWNERS 文件](https://help.github.com/en/github/creating-cloning-and-archiving-repositories/about-code-owners)将特定库的所有权分配给用户或团队。

## 我应该添加到现有的库吗?

通过将代码保存在现有库中来限制库的数量也有好处。

### 1. 合并代码

相关代码应紧密相连。
如果开发人员可以在不移动多个不同文件夹的情况下完成一项任务，这将帮助他们工作得更快，犯更少的错误。
每个新库都会添加一些文件夹和配置文件，这些文件夹和配置文件不会直接对业务价值做出贡献。
Nx 有助于降低添加新库的成本，但它不是零。

### 2. 删除约束

特别是对于快速发展的代码，标准的体系结构约束可能会阻碍实验和探索。
在单个库中开发一段时间可能是值得的，这样可以让真正的体系结构出现，然后在更改的速度减慢后重构为多个库。
